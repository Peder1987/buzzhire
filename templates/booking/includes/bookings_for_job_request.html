{% load humanize icons freelancer feedback driver %}

{% if request.user.is_admin %}
    <h5>Bookings</h5>
    {% if object.bookings.all %}
        <table class='table middle-align'>
            <thead>
                <th>Driver</th>
                <th>Booking reference</th>
                <th></th>
            </thead>
            {% for booking in object.bookings.all %}
               <tr>
                  <td>
                    <a href='{% url 'driver_detail' booking.freelancer.pk %}'>
                        {% profile_photo booking.freelancer 'small' %}
                        {{ booking.freelancer.get_full_name }}
                    </a>
                  </td>
                  <td class='monospace'>{{ booking }}</td>
                  <td class='text-right'><a class='btn btn-sm btn-default' href='{% url 'admin:booking_booking_change' booking.pk %}'>{{ 'edit'|icon }} edit</a>
               </tr>
            {% endfor %}
        </table>
        
    {% else %}
        <p>No bookings yet.</p>
    {% endif %}
    <h5>Invitations</h5>
    {% if object.invitations.all %}
        <table class='table middle-align'>
            <thead>
                <th>Driver</th>
                <th>Date invited</th>
                <th>Date accepted</th>
                <th></th>
            </thead>
            {% for invitation in object.invitations.all %}
               <tr>
                  <td>
                    <a href='{% url 'driver_detail' invitation.freelancer.pk %}'>
                        {% profile_photo invitation.freelancer 'small' %}
                        {{ invitation.freelancer.get_full_name }}
                    </a>
                  </td>
                  <td>{{ invitation.date_created|naturalday }}</td>
                  <td>{% if invitation.date_accepted %}{{ invitation.date_accepted|naturalday }}{% endif %}</td>
                  <td class='text-right'><a class='btn btn-sm btn-default' href='{% url 'admin:booking_invitation_change' invitation.pk %}'>{{ 'edit'|icon }} edit</a>
               </tr>
            {% endfor %}
        </table>
        
    {% else %}
        <p>No one has been invited yet.</p>
    {% endif %}

{% else %}
    {% with object.bookings.published as bookings %} 
        {% if bookings %}
            <div class="panel panel-default driver-list">
              <div class="panel-heading">
                <div class='row'>
                    <div class='col-md-6'>
                        <h3 class="panel-title">{{ 'driver'|icon }} Your driver{{ bookings|pluralize }}</h3>
                    </div>
                    <div class='col-md-6'>
                        {% include 'feedback/includes/feedback_button.html' %}
                    </div>
                </div>
                
                
              </div>
              <div class="list-group">
                {% for booking in bookings %}
                    {% with driver=booking.freelancer|driver_from_freelancer %}
                        <a href="{{ driver.get_absolute_url }}" class="list-group-item">
                            <div class='row'>
                                <div class='col-md-2'>
                                    {% profile_photo driver 'small'  %}
                                </div>
                                <div class='col-md-6'>
                                    <h5>{{ driver.get_full_name }}</h5>
                                    <div class='average-feedback-score'>
                                        {% average_score driver.average_score %}
                                    </div>
                                    {{ driver.get_driving_experience_display }} of experience.
                                </div>
                                <div class='col-md-4'>
                                    {% feedback_for_freelancer_own booking %}
                                </div>
                            </div>
                        </a>
                     {% endwith %}
                {% endfor %}
              </div>
            </div>
        {% endif %}
    {% endwith %}
{% endif %}